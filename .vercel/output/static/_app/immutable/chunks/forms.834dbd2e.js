import{p as b}from"./parse.5567e4e2.js";import{j as r}from"./singletons.db5ade20.js";r.disable_scroll_handling;r.goto;r.invalidate;const f=r.invalidateAll;r.preload_data;r.preload_code;r.before_navigate;r.after_navigate;const y=r.apply_action;function h(t){const o=JSON.parse(t);return o.data&&(o.data=b(o.data)),o}function w(t,o=()=>{}){const l=async({action:e,result:a,reset:i})=>{a.type==="success"&&(i!==!1&&HTMLFormElement.prototype.reset.call(t),await f()),(location.origin+location.pathname===e.origin+e.pathname||a.type==="redirect"||a.type==="error")&&y(a)};async function s(e){e.preventDefault();const a=new URL(e.submitter?.hasAttribute("formaction")?e.submitter.formAction:HTMLFormElement.prototype.cloneNode.call(t).action),i=new FormData(t),p=e.submitter?.getAttribute("name");p&&i.append(p,e.submitter?.getAttribute("value")??"");const d=new AbortController;let m=!1;const u=await o({action:a,cancel:()=>m=!0,controller:d,data:i,form:t,submitter:e.submitter})??l;if(m)return;let c;try{const n=await fetch(a,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:i,signal:d.signal});c=h(await n.text()),c.type==="error"&&(c.status=n.status)}catch(n){if(n?.name==="AbortError")return;c={type:"error",error:n}}u({action:a,data:i,form:t,update:n=>l({action:a,result:c,reset:n?.reset}),result:c})}return HTMLFormElement.prototype.addEventListener.call(t,"submit",s),{destroy(){HTMLFormElement.prototype.removeEventListener.call(t,"submit",s)}}}export{w as e};
